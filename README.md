# PhpUnitExtended
[![Scrutinizer Build Status](https://img.shields.io/scrutinizer/build/g/yoanm/PhpUnitExtended.svg?label=Scrutinizer)](https://scrutinizer-ci.com/g/yoanm/PhpUnitExtended/?branch=master) [![Scrutinizer Code Quality](https://img.shields.io/scrutinizer/g/yoanm/PhpUnitExtended.svg?label=Code%20quality)](https://scrutinizer-ci.com/g/yoanm/PhpUnitExtended/?branch=master) [![Code Coverage](https://img.shields.io/scrutinizer/coverage/g/yoanm/PhpUnitExtended.svg?label=Coverage)](https://scrutinizer-ci.com/g/yoanm/PhpUnitExtended/?branch=master)

[![Travis Build Status](https://img.shields.io/travis/yoanm/PhpUnitExtended/master.svg?label=travis)](https://travis-ci.org/yoanm/PhpUnitExtended) [![PHP Versions](https://img.shields.io/badge/php-5.5%20%2F%205.6%20%2F%207.0-8892BF.svg)](https://php.net/)

[![Latest Stable Version](https://img.shields.io/packagist/v/yoanm/php-unit-extended.svg)](https://packagist.org/packages/yoanm/php-unit-extended)

Php library to extend PhpUnit
> :information_source: **See [Tests strategy compliance](./TESTS_STRATEGY_COMPLIANCE.md)**

 * [Install](#install)
 * [Config and requirements](#config-and-requirements)
  * [TestsStrategyListener](#config-and-requirement-testsstrategylistener)
    * [Convert risky test into failed test](#config-and-requirement-testsstrategylistener-risky-to-failed)
      * [Test that output something](#config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-with-output)
      * [Test that do not test anything](#config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-tests-nothing)
      * [Test that manipulates globals](#config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-manipulates-globals)
      * [Test that have coverage overflow](#config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-with-coverage-overflow)
    * [Remove coverage generated by a risky test that have an output](#config-and-requirement-testsstrategylistener-remove-coverage-risky-output)
 * [Contributing](#contributing)

# Install
```bash
composer require --dev yoanm/php-unit-extended
```
<a name="config-and-requirements"></a>
## Config and requirements

<a name="config-and-requirement-testsstrategylistener"></a>
### TestsStrategyListener

*See [PhpUnit configuration reference](https://phpunit.de/manual/current/en/appendixes.configuration.html) and [PhpUnit Risky tests](https://phpunit.de/manual/current/en/risky-tests.html) for more information about a specific option*

`TestsStrategyListener` will allow test type conversion and coverage removal

<a name="config-and-requirement-testsstrategylistener-required-config"></a>
**Required configuration**
```xml
<phpunit>
  <listeners>
        <listener class="Yoanm\PhpUnitExtended\Listener\TestsStrategyListener"/>
  </listeners>
</phpunit>
```

<a name="config-and-requirement-testsstrategylistener-risky-to-failed"></a>
#### Convert risky test into failed test

Listener will add a failure for each risky test listed below

<a name="config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-with-output"></a>
##### Test that output something

 * [Listener configuration](#config-and-requirement-testsstrategylistener-required-config)
 * Add `beStrictAboutOutputDuringTests="true"` in the configuration file or use `--disallow-test-output` command line option

<a name="config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-tests-nothing"></a>
##### Test that do not test anything

 * [Listener configuration](#config-and-requirement-testsstrategylistener-required-config)
 * Add `beStrictAboutTestsThatDoNotTestAnything="true"` in the configuration file or use `--report-useless-tests` command line option

<a name="config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-manipulates-globals"></a>
##### Test that manipulates globals

 * [Listener configuration](#config-and-requirement-testsstrategylistener-required-config)
 * Add `beStrictAboutChangesToGlobalState="true"` in the configuration file or use `--strict-global-state` command line option

<a name="config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-manipulates-globals-variables"></a>
###### For globals variables

 * [Requirements described above](#config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-manipulates-globals)
 * Add `backupGlobals="true"` in the configuration file or add `@backupGlobals enabled` in the test

<a name="config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-manipulates-globals-attributes"></a>
###### For static attributes

 * [Requirements described above](#config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-manipulates-globals)
 * Add `backupStaticAttributes="true"` in the configuration file or add `@backupStaticAttributes enabled` in the test

<a name="config-and-requirement-testsstrategylistener-risky-to-failed-risky-test-test-with-coverage-overflow"></a>
##### Test that have coverage overflow

 * [Listener configuration](#config-and-requirement-testsstrategylistener-required-config)
 * Add `checkForUnintentionallyCoveredCode="true"` in the configuration file or use `--strict-coverage` command line option
 * Add `forceCoversAnnotation="true"` in the configuration file

<a name="config-and-requirement-testsstrategylistener-remove-coverage-risky-output"></a>
#### Remove coverage generated by a risky test that have an output

 * [Listener configuration](#config-and-requirement-testsstrategylistener-required-config)
 * Add `beStrictAboutOutputDuringTests="true"` in the configuration file or use `--disallow-test-output` command line option

# Contributing
See [contributing note](./CONTRIBUTING.md)
